<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数组合（compose） | Front-end-programming</title>
    <meta name="description" content="Front end programming">
    
    
    <link rel="preload" href="/assets/css/0.styles.cc2a2ebf.css" as="style"><link rel="preload" href="/assets/js/app.2f7a4d7a.js" as="script"><link rel="preload" href="/assets/js/5.1b8d22a8.js" as="script"><link rel="prefetch" href="/assets/js/10.c92c51be.js"><link rel="prefetch" href="/assets/js/11.ffc2da93.js"><link rel="prefetch" href="/assets/js/12.2fc92c8e.js"><link rel="prefetch" href="/assets/js/13.d69d8942.js"><link rel="prefetch" href="/assets/js/14.a5b0411d.js"><link rel="prefetch" href="/assets/js/15.3c87745f.js"><link rel="prefetch" href="/assets/js/16.dfaa2ca4.js"><link rel="prefetch" href="/assets/js/17.8c065f36.js"><link rel="prefetch" href="/assets/js/18.42f3cd96.js"><link rel="prefetch" href="/assets/js/19.c7b07917.js"><link rel="prefetch" href="/assets/js/2.5ae90992.js"><link rel="prefetch" href="/assets/js/20.d99228e7.js"><link rel="prefetch" href="/assets/js/21.c2ad7010.js"><link rel="prefetch" href="/assets/js/22.991426d2.js"><link rel="prefetch" href="/assets/js/23.888c6bc1.js"><link rel="prefetch" href="/assets/js/24.1aa16f53.js"><link rel="prefetch" href="/assets/js/25.dfbfd353.js"><link rel="prefetch" href="/assets/js/3.65c88191.js"><link rel="prefetch" href="/assets/js/4.7f39a3d8.js"><link rel="prefetch" href="/assets/js/6.d49d3124.js"><link rel="prefetch" href="/assets/js/7.4a677518.js"><link rel="prefetch" href="/assets/js/8.90e3d82b.js"><link rel="prefetch" href="/assets/js/9.e6844887.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc2a2ebf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Front-end-programming</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/functional-programming/js-fp/" class="sidebar-link">介绍</a></li><li><a href="/functional-programming/js-fp/purity.html" class="sidebar-link">纯函数</a></li><li><a href="/functional-programming/js-fp/curry.html" class="sidebar-link">柯里化（curry）</a></li><li><a href="/functional-programming/js-fp/compose.html" class="active sidebar-link">函数组合（compose）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/compose.html#组合的特性" class="sidebar-link">组合的特性</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/compose.html#pointfree" class="sidebar-link">pointfree</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/compose.html#debug" class="sidebar-link">debug</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/compose.html#范畴学" class="sidebar-link">范畴学</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/compose.html#练习" class="sidebar-link">练习</a></li></ul></li><li><a href="/functional-programming/js-fp/hindley-milner.html" class="sidebar-link">Hindley-Milner (类型签名)</a></li><li><a href="/functional-programming/js-fp/example.html" class="sidebar-link">应用示例</a></li><li><a href="/functional-programming/js-fp/functor.html" class="sidebar-link">Funcoter (函子/容器)</a></li><li><a href="/functional-programming/js-fp/monad.html" class="sidebar-link">Monad</a></li><li><a href="/functional-programming/js-fp/applicative.html" class="sidebar-link">applicative functor</a></li><li><a href="/functional-programming/js-fp/appendix.html" class="sidebar-link">附录</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="函数组合（compose）"><a href="#函数组合（compose）" aria-hidden="true" class="header-anchor">#</a> 函数组合（compose）</h1> <p>接收多个函数作为参数，从右到左，一个函数的输入为另一个函数的输出。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre></div><p><code>f</code> 和 <code>g</code> 都是函数，<code>x</code> 是他们之间通过管道传输的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">toUpperCase</span> <span class="token operator">=</span> x <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">exclaim</span> <span class="token operator">=</span> x <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token string">'!'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> shout <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">)</span>

<span class="token function">shout</span><span class="token punctuation">(</span><span class="token string">'send in the clowns'</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt;  &quot;SEND IN THE CLOWNS!&quot;</span>

</code></pre></div><p>在 <code>compose</code> 的定义中, <code>g</code> 将先于 <code>f</code> 执行，因此就创建了一个从右到左的数据流， 大大提高了可读性</p> <h2 id="组合的特性"><a href="#组合的特性" aria-hidden="true" class="header-anchor">#</a> 组合的特性</h2> <p>结合律</p> <div class="language-js extra-class"><pre class="language-js"><code>
  <span class="token keyword">var</span> associative <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>
  <span class="token comment">// =&gt; true</span>

</code></pre></div><p>结合律的好处就是函数的分组可以被拆开，然后再以他们自己的方式组合到一起。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>

<span class="token comment">// 或者</span>
<span class="token keyword">var</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
<span class="token keyword">var</span> angry <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">)</span>
<span class="token keyword">var</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>angry<span class="token punctuation">,</span> last<span class="token punctuation">)</span>

</code></pre></div><p>通常来，最佳的实践是让组合可以重用，就像 <code>last</code> 和 <code>angry</code> 一样</p> <h2 id="pointfree"><a href="#pointfree" aria-hidden="true" class="header-anchor">#</a> pointfree</h2> <p>不必说明你需要的数据</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 非 pointfree，因为提到了数据：word</span>
<span class="token keyword">var</span> <span class="token function-variable function">snakeCase</span> <span class="token operator">=</span>  word <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/ig</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// pointfree</span>
<span class="token keyword">var</span> snakeCase <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/ig</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toLowerCase<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>pointfree 能帮助我们减少不必要的命名， 让代码保持简洁和通用。
不过也要警惕，pointfree 是双刃剑保持简洁的同时，可能造成混乱。并不是所有代码都适用，如果不能使用，就用普通函数</p> <h2 id="debug"><a href="#debug" aria-hidden="true" class="header-anchor">#</a> debug</h2> <p>如果在 debug 组合的时候遇到了困难，那么可以使用下面这个实用的，但是不纯的 trace 函数来追踪代码的执行情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> trace <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toLower<span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s{2,}/ig</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="范畴学"><a href="#范畴学" aria-hidden="true" class="header-anchor">#</a> 范畴学</h2> <p>范畴学（category theory）是数学中的一个抽象分支，能够形式化诸如集合论（set theory）、类型论（type theory）、群论（group theory）以及逻辑学（logic）等数学分支中的一些概念。范畴学主要处理对象（object）、态射（morphism）和变化式（transformation），而这些概念跟编程的联系非常紧密。</p> <p>在范畴学中，有一个概念叫做...范畴,有着以下这些组件（component）的搜集（collection）就构成了一个范畴：</p> <ul><li>对象的搜集</li> <li>态射的搜集</li> <li>态射的组合</li> <li>identity 这个独特的态射</li></ul> <h4 id="对象的搜集"><a href="#对象的搜集" aria-hidden="true" class="header-anchor">#</a> 对象的搜集</h4> <p>对象就是数据类型， 通常我们把数据类型视作所有可能的值的一个集合（set）。像 Boolean 就可以看作是 [true, false] 的集合，Number 可以是所有实数的一个集合</p> <h4 id="态射的搜集"><a href="#态射的搜集" aria-hidden="true" class="header-anchor">#</a> 态射的搜集</h4> <p>态射是标准的、普通的纯函数。
态射的组合</p> <h4 id="态射的组合"><a href="#态射的组合" aria-hidden="true" class="header-anchor">#</a> 态射的组合</h4> <p>compose 函数，结合律是在范畴学中对任何组合都适用的一个特性。</p> <h4 id="identity-这个独特的态射"><a href="#identity-这个独特的态射" aria-hidden="true" class="header-anchor">#</a> identity 这个独特的态射</h4> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> <span class="token function-variable function">id</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// identity</span>
<span class="token function">compose</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">;</span>
<span class="token comment">// true</span>

</code></pre></div><h2 id="练习"><a href="#练习" aria-hidden="true" class="header-anchor">#</a> 练习</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> spt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./supports'</span><span class="token punctuation">)</span>

<span class="token comment">// 示例数据</span>
<span class="token keyword">var</span> <span class="token constant">CARS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Ferrari FF&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">660</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">700000</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Spyker C12 Zagato&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">650</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">648000</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Jaguar XKR-S&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">550</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">132000</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Audi R8&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">525</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">114200</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Aston Martin One-77&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">750</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">1850000</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Pagani Huayra&quot;</span><span class="token punctuation">,</span> horsepower<span class="token punctuation">:</span> <span class="token number">700</span><span class="token punctuation">,</span> dollar_value<span class="token punctuation">:</span> <span class="token number">1300000</span><span class="token punctuation">,</span> in_stock<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 练习 1:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 _.compose() 重写下面这个函数。提示：_.prop() 是 curry 函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">isLastInStock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> last_car <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">,</span> last_car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 练习 2:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 _.compose()、_.prop() 和 _.head() 获取第一个 car 的 name</span>
<span class="token keyword">var</span> nameOfFirstCar <span class="token operator">=</span> undefined<span class="token punctuation">;</span>


<span class="token comment">// 练习 3:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用帮助函数 _average 重构 averageDollarValue 使之成为一个组合</span>
<span class="token keyword">var</span> <span class="token function-variable function">_average</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> spt<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span>add<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> xs<span class="token punctuation">)</span> <span class="token operator">/</span> xs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// &lt;- 无须改动</span>

<span class="token keyword">var</span> <span class="token function-variable function">averageDollarValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dollar_values <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span>dollar_value<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">_average</span><span class="token punctuation">(</span>dollar_values<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 练习 4:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 compose 写一个 sanitizeNames() 函数，返回一个下划线连接的小写字符串：例如：sanitizeNames([&quot;Hello World&quot;]) //=&gt; [&quot;hello_world&quot;]。</span>

<span class="token keyword">var</span> _underscore <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\W+/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&lt;-- 无须改动，并在 sanitizeNames 中使用它</span>

<span class="token keyword">var</span> sanitizeNames <span class="token operator">=</span> undefined<span class="token punctuation">;</span>


<span class="token comment">// 彩蛋 1:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 使用 compose 重构 availablePrices</span>

<span class="token keyword">var</span> <span class="token function-variable function">availablePrices</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> available_cars <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> available_cars<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> accounting<span class="token punctuation">.</span><span class="token function">formatMoney</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>dollar_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 彩蛋 2:</span>
<span class="token comment">// ============</span>
<span class="token comment">// 重构使之成为 pointfree 函数。提示：可以使用 _.flip()</span>

<span class="token keyword">var</span> <span class="token function-variable function">fastestCar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sorted <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>car<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> car<span class="token punctuation">.</span>horsepower <span class="token punctuation">}</span><span class="token punctuation">,</span> cars<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fastest <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>sorted<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fastest<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">' is the fastest'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>






<span class="token comment">// =========== 答案</span>

<span class="token comment">// 1</span>
<span class="token keyword">const</span> _isLastInstock <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span>last<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_isLastInstock</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 2</span>
<span class="token keyword">const</span> _nameOfFirstCar <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span>head<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_nameOfFirstCar</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 3</span>
<span class="token keyword">const</span> _averageDollarValue <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>_average<span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'dollar_value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_averageDollarValue</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 4</span>
<span class="token keyword">const</span> _sanitizeNames <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span>toLowerCase<span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_underscore<span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_sanitizeNames</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 彩蛋1</span>
<span class="token keyword">const</span> formatMoney <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">formatMoney</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'$'</span> <span class="token operator">+</span> x
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> _availablePrices <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>formatMoney<span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'dollar_value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'in_stock'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_availablePrices</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 彩蛋2</span>
<span class="token keyword">const</span> append <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span>concat<span class="token punctuation">)</span>
<span class="token keyword">const</span> _fastestCar <span class="token operator">=</span> spt<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">' is the fastest'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spt<span class="token punctuation">.</span>last<span class="token punctuation">,</span> spt<span class="token punctuation">.</span><span class="token function">sortBy</span><span class="token punctuation">(</span>spt<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'horsepower'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_fastestCar</span><span class="token punctuation">(</span><span class="token constant">CARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/functional-programming/js-fp/curry.html" class="prev">
          柯里化（curry）
        </a></span> <span class="next"><a href="/functional-programming/js-fp/hindley-milner.html">
          Hindley-Milner (类型签名)
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/5.1b8d22a8.js" defer></script><script src="/assets/js/app.2f7a4d7a.js" defer></script>
  </body>
</html>
