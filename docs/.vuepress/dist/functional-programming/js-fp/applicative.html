<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>applicative functor | Front-end-programming</title>
    <meta name="description" content="Front end programming">
    
    
    <link rel="preload" href="/assets/css/0.styles.cc2a2ebf.css" as="style"><link rel="preload" href="/assets/js/app.2f7a4d7a.js" as="script"><link rel="preload" href="/assets/js/4.7f39a3d8.js" as="script"><link rel="prefetch" href="/assets/js/10.c92c51be.js"><link rel="prefetch" href="/assets/js/11.ffc2da93.js"><link rel="prefetch" href="/assets/js/12.2fc92c8e.js"><link rel="prefetch" href="/assets/js/13.d69d8942.js"><link rel="prefetch" href="/assets/js/14.a5b0411d.js"><link rel="prefetch" href="/assets/js/15.3c87745f.js"><link rel="prefetch" href="/assets/js/16.dfaa2ca4.js"><link rel="prefetch" href="/assets/js/17.8c065f36.js"><link rel="prefetch" href="/assets/js/18.42f3cd96.js"><link rel="prefetch" href="/assets/js/19.c7b07917.js"><link rel="prefetch" href="/assets/js/2.5ae90992.js"><link rel="prefetch" href="/assets/js/20.d99228e7.js"><link rel="prefetch" href="/assets/js/21.c2ad7010.js"><link rel="prefetch" href="/assets/js/22.991426d2.js"><link rel="prefetch" href="/assets/js/23.888c6bc1.js"><link rel="prefetch" href="/assets/js/24.1aa16f53.js"><link rel="prefetch" href="/assets/js/25.dfbfd353.js"><link rel="prefetch" href="/assets/js/3.65c88191.js"><link rel="prefetch" href="/assets/js/5.1b8d22a8.js"><link rel="prefetch" href="/assets/js/6.d49d3124.js"><link rel="prefetch" href="/assets/js/7.4a677518.js"><link rel="prefetch" href="/assets/js/8.90e3d82b.js"><link rel="prefetch" href="/assets/js/9.e6844887.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc2a2ebf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Front-end-programming</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/functional-programming/js-fp/" class="sidebar-link">介绍</a></li><li><a href="/functional-programming/js-fp/purity.html" class="sidebar-link">纯函数</a></li><li><a href="/functional-programming/js-fp/curry.html" class="sidebar-link">柯里化（curry）</a></li><li><a href="/functional-programming/js-fp/compose.html" class="sidebar-link">函数组合（compose）</a></li><li><a href="/functional-programming/js-fp/hindley-milner.html" class="sidebar-link">Hindley-Milner (类型签名)</a></li><li><a href="/functional-programming/js-fp/example.html" class="sidebar-link">应用示例</a></li><li><a href="/functional-programming/js-fp/functor.html" class="sidebar-link">Funcoter (函子/容器)</a></li><li><a href="/functional-programming/js-fp/monad.html" class="sidebar-link">Monad</a></li><li><a href="/functional-programming/js-fp/applicative.html" class="active sidebar-link">applicative functor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#ap-函数" class="sidebar-link">ap 函数</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#例子" class="sidebar-link">例子</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#lift" class="sidebar-link">lift</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#开瓶器" class="sidebar-link">开瓶器</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#定律" class="sidebar-link">定律</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#同一律" class="sidebar-link">同一律</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#同态" class="sidebar-link">同态</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#互换" class="sidebar-link">互换</a></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#组合（composition）" class="sidebar-link">组合（composition）</a></li></ul></li><li class="sidebar-sub-header"><a href="/functional-programming/js-fp/applicative.html#练习" class="sidebar-link">练习</a></li></ul></li><li><a href="/functional-programming/js-fp/appendix.html" class="sidebar-link">附录</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="applicative-functor"><a href="#applicative-functor" aria-hidden="true" class="header-anchor">#</a> applicative functor</h1> <blockquote><p><code>ap</code> 能够把一个 <code>functor</code> 的函数值应用到另一个 <code>functor</code> 的值上
<code>applicative</code> <code>functor</code> 是实现了 <code>ap</code> 方法的 <code>pointed functor</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
Container<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Container<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; Container(5)</span>

Container<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Container<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; Container(5)</span>

</code></pre></div><h2 id="ap-函数"><a href="#ap-函数" aria-hidden="true" class="header-anchor">#</a> ap 函数</h2> <div class="language-js extra-class"><pre class="language-js"><code>Container<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">ap</span> <span class="token operator">=</span> other_container <span class="token operator">=&gt;</span> other_container<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span>

</code></pre></div><h2 id="特性"><a href="#特性" aria-hidden="true" class="header-anchor">#</a> 特性</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token constant">F</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">F</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p><code>map</code> 一个 <code>f</code> 等价于 <code>ap</code> 一个 值为 <code>f</code> 的 <code>functor</code></p> <h2 id="例子"><a href="#例子" aria-hidden="true" class="header-anchor">#</a> 例子</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// $ :: String -&gt; IO DOM</span>
<span class="token keyword">const</span> <span class="token function-variable function">$</span> <span class="token operator">=</span> selector <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// getVal :: String -&gt; IO String</span>
<span class="token keyword">const</span> getVal <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// signIn :: String -&gt; String -&gt; Bool -&gt; User</span>
<span class="token keyword">const</span> signIn <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> rememberMe<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* signing in */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">IO</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>signIn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getVal</span><span class="token punctuation">(</span><span class="token string">'#email'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getVal</span><span class="token punctuation">(</span><span class="token string">'#password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">IO</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// IO({ id: 3, email: 'gg@allin.com' })</span>

</code></pre></div><p><code>signIn</code> 是一个接收 3 个参数的 <code>curry</code> 函数, 每一次的 <code>ap</code> 调用就收到一个参数， 所有的参数都传进来，它也就执行完毕</p> <h2 id="lift"><a href="#lift" aria-hidden="true" class="header-anchor">#</a> lift</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> liftA2 <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> liftA3 <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">liftA2</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Maybe(5)</span>

</code></pre></div><h2 id="开瓶器"><a href="#开瓶器" aria-hidden="true" class="header-anchor">#</a> 开瓶器</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 从 of/ap 衍生出的 map</span>
<span class="token constant">X</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从 chain 衍生出的 map</span>
x<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从 chain/map 衍生出的 ap</span>
<span class="token constant">X</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">ap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> other<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="定律"><a href="#定律" aria-hidden="true" class="header-anchor">#</a> 定律</h2> <p><code>ap</code> 不会改变容器的类型， 这一点优于 <code>monad</code></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> tOfM <span class="token operator">=</span> Maybe<span class="token punctuation">.</span><span class="token keyword">of</span>

<span class="token function">liftA2</span><span class="token punctuation">(</span>concat<span class="token punctuation">,</span> <span class="token function">tOfM</span><span class="token punctuation">(</span><span class="token string">'Rainy Days and Mondays'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">tOfM</span><span class="token punctuation">(</span><span class="token string">' always get me down'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; Maybe { '$value': 'Rainy Days and Mondays always get me down' }</span>

</code></pre></div><h3 id="同一律"><a href="#同一律" aria-hidden="true" class="header-anchor">#</a> 同一律</h3> <div class="language-js extra-class"><pre class="language-js"><code>
  <span class="token comment">// 等同于 map</span>
  <span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span> v

</code></pre></div><h3 id="同态"><a href="#同态" aria-hidden="true" class="header-anchor">#</a> 同态</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 左边先放入容器，再进行计算， 右边先计算在放入容器</span>
<span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="互换"><a href="#互换" aria-hidden="true" class="header-anchor">#</a> 互换</h3> <p>互换（interchange）表明的是选择让函数在 ap 的左边还是右边发生 lift 是无关紧要的。</p> <div class="language-js extra-class"><pre class="language-js"><code>
v<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>


<span class="token keyword">var</span> v <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>reverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">'Sparklehorse'</span><span class="token punctuation">;</span>

v<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> Task<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>

</code></pre></div><h3 id="组合（composition）"><a href="#组合（composition）" aria-hidden="true" class="header-anchor">#</a> 组合（composition）</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// compose(u, v, w)</span>
<span class="token constant">A</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>compose<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">==</span> u<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="练习"><a href="#练习" aria-hidden="true" class="header-anchor">#</a> 练习</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">,</span>
  add<span class="token punctuation">,</span>
  head<span class="token punctuation">,</span>
  concat<span class="token punctuation">,</span>
  reduce<span class="token punctuation">,</span>
  prop<span class="token punctuation">,</span>
  curry<span class="token punctuation">,</span>
  compose<span class="token punctuation">,</span>
  Maybe<span class="token punctuation">,</span>
  Task<span class="token punctuation">,</span>
  trace<span class="token punctuation">,</span>
  Left<span class="token punctuation">,</span>
  Right<span class="token punctuation">,</span>
  Either<span class="token punctuation">,</span>
  either<span class="token punctuation">,</span>
  <span class="token constant">IO</span><span class="token punctuation">,</span>
  toUpperCase<span class="token punctuation">,</span>
  id<span class="token punctuation">,</span>
  Identity<span class="token punctuation">,</span>
  liftA2<span class="token punctuation">,</span>
  liftA3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./supports'</span><span class="token punctuation">)</span>


  <span class="token comment">// 模拟浏览器的 localStorage 对象</span>
  <span class="token keyword">var</span> localStorage <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>



  <span class="token comment">// 练习 1</span>
  <span class="token comment">// ==========</span>
  <span class="token comment">// 写一个函数，使用 Maybe 和 ap() 实现让两个可能是 null 的数值相加。</span>

  <span class="token comment">//  ex1 :: Number -&gt; Number -&gt; Maybe Number</span>
  <span class="token keyword">var</span> <span class="token function-variable function">ex1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>


  <span class="token comment">// 练习 2</span>
  <span class="token comment">// ==========</span>
  <span class="token comment">// 写一个函数，接收两个 Maybe 为参数，让它们相加。使用 liftA2 代替 ap()。</span>

  <span class="token comment">//  ex2 :: Maybe Number -&gt; Maybe Number -&gt; Maybe Number</span>
  <span class="token keyword">var</span> ex2 <span class="token operator">=</span> undefined



  <span class="token comment">// 练习 3</span>
  <span class="token comment">// ==========</span>
  <span class="token comment">// 运行 getPost(n) 和 getComments(n)，两者都运行完毕后执行渲染页面的操作。（参数 n 可以是任意值）。</span>

  <span class="token keyword">var</span> makeComments <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> acc<span class="token operator">+</span><span class="token string">&quot;&lt;li&gt;&quot;</span><span class="token operator">+</span>c<span class="token operator">+</span><span class="token string">&quot;&lt;/li&gt;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> render <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> cs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;&lt;div&gt;&quot;</span><span class="token operator">+</span>p<span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">&quot;&lt;/div&gt;&quot;</span><span class="token operator">+</span><span class="token function">makeComments</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//  ex3 :: Task Error HTML</span>
  <span class="token keyword">var</span> ex3 <span class="token operator">=</span> undefined



  <span class="token comment">// 练习 4</span>
  <span class="token comment">// ==========</span>
  <span class="token comment">// 写一个 IO，从缓存中读取 player1 和 player2，然后开始游戏。</span>

  localStorage<span class="token punctuation">.</span>player1 <span class="token operator">=</span> <span class="token string">&quot;toby&quot;</span>
  localStorage<span class="token punctuation">.</span>player2 <span class="token operator">=</span> <span class="token string">&quot;sally&quot;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">getCache</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> localStorage<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> game <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token string">' vs '</span> <span class="token operator">+</span> p2 <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//  ex4 :: IO String</span>
  <span class="token keyword">var</span> ex4 <span class="token operator">=</span> undefined





  <span class="token comment">// 帮助函数</span>
  <span class="token comment">// =====================</span>

  <span class="token keyword">function</span> <span class="token function">getPost</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>rej<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> i<span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'Love them futures'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">getComments</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>rej<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;This book should be illegal&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Monads are like space burritos&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>




<span class="token comment">// =========== 答案</span>

<span class="token comment">// 1</span>
<span class="token comment">// _ex1 :: Number -&gt; Number -&gt; Maybe Number</span>
<span class="token keyword">const</span> <span class="token function-variable function">_ex1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_ex1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_ex1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 2</span>
<span class="token comment">// _ex2 :: Maybe Number -&gt; Maybe Number -&gt; Maybe Number</span>
<span class="token keyword">const</span> _ex2 <span class="token operator">=</span> <span class="token function">liftA2</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">_ex2</span><span class="token punctuation">(</span>Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Maybe<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 3</span>
<span class="token comment">// _ex3 :: Task Error HTML</span>
<span class="token keyword">const</span> _ex3 <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getComments</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

_ex3<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>er <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>er<span class="token punctuation">)</span><span class="token punctuation">,</span> rs <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 4</span>
<span class="token comment">//  _ex4 :: IO String</span>
<span class="token keyword">const</span> _ex4 <span class="token operator">=</span> <span class="token constant">IO</span><span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>game<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">'player1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">'player2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_ex4<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/functional-programming/js-fp/monad.html" class="prev">
          Monad
        </a></span> <span class="next"><a href="/functional-programming/js-fp/appendix.html">
          附录
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/4.7f39a3d8.js" defer></script><script src="/assets/js/app.2f7a4d7a.js" defer></script>
  </body>
</html>
